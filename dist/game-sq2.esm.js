"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n},writable:!0,configurable:!0}),function(){for(var e=0,t=["webkit","moz","ms","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),o=window.setTimeout((function(){return t(n+r)}),r);return e=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){if("undefined"!=typeof window){var e,t="ontouchstart"in window;document.createTouch||(document.createTouch=function(e,t,r,o,i,l,a){return new n(t,r,{pageX:o,pageY:i,screenX:l,screenY:a,clientX:o-window.pageXOffset,clientY:i-window.pageYOffset},0,0)}),document.createTouchList||(document.createTouchList=function(){for(var e=o(),t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length=arguments.length,e}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var n=function(e,t,n,r,o){r=r||0,o=o||0,this.identifier=t,this.target=e,this.clientX=n.clientX+r,this.clientY=n.clientY+o,this.screenX=n.screenX+r,this.screenY=n.screenY+o,this.pageX=n.pageX+r,this.pageY=n.pageY+o},r=!1;s.multiTouchOffset=75,t||new s}function o(){var e=[];return e.item=function(e){return this[e]||null},e.identifiedTouch=function(e){return this[e+1]||null},e}function i(t){return function(n){var o,i,s;("mousedown"===n.type&&(r=!0),"mouseup"===n.type&&(r=!1),"mousemove"!==n.type||r)&&(("mousedown"===n.type||!e||e&&!e.dispatchEvent)&&(e=n.target),null==e.closest("[data-no-touch-simulate]")&&(o=t,i=n,(s=document.createEvent("Event")).initEvent(o,!0,!0),s.altKey=i.altKey,s.ctrlKey=i.ctrlKey,s.metaKey=i.metaKey,s.shiftKey=i.shiftKey,s.touches=a(i),s.targetTouches=a(i),s.changedTouches=l(i),e.dispatchEvent(s)),"mouseup"===n.type&&(e=null))}}function l(t){var r=o();return r.push(new n(e,1,t,0,0)),r}function a(e){return"mouseup"===e.type?o():l(e)}function s(){window.addEventListener("mousedown",i("touchstart"),!0),window.addEventListener("mousemove",i("touchmove"),!0),window.addEventListener("mouseup",i("touchend"),!0)}}();function e(e){return e&&"function"==typeof e}function t(t,n,r,o){var i;if(o=o||!1,!(void 0!==(i=t)&&i instanceof HTMLElement&&1===i.nodeType))throw"the argument of el is not HTMLElement";if(!e(r))throw"the argument of fn must be a function";t.addEventListener(n,(function e(o){r.bind(o)(),~"animationend transitionend".indexOf(n)&&t.removeEventListener(n,e)})),o&&(t=null)}var n={gridWidth:4,gridHeight:4,gridSizeWidth:100,gridSizeHeight:100,gridGap:20,showGridValue:!0,cls:{grid:"game-grid",gridTpl:"grid_"},grids:[{level:0,value:2,style:{"background-color":"rgb(238,228,218)",color:"black"}},{level:1,value:4,style:{"background-color":"rgb(238,224,200)",color:"rgb(124,115,106)"}},{level:2,value:8,style:{"background-color":"rgb(242,177,121)",color:"rgb(255,247,235)"}},{level:3,value:16,style:{"background-color":"rgb(245,149,99)",color:"rgb(255,247,235)"}},{level:4,value:32,style:{"background-color":"rgb(237,93,59)",color:"rgb(255,247,235)"}},{level:5,value:64,style:{"background-color":"rgb(236,206,112)",color:"rgb(255,247,235)"}},{level:6,value:128,style:{"background-color":"rgb(237,204,97)",color:"rgb(255,247,235)"}},{level:7,value:256,style:{"background-color":"rgb(236,200,80)",color:"rgb(255,247,235)"}},{level:8,value:512,style:{"background-color":"rgb(237,197,63)",color:"rgb(255,247,235)"}},{level:9,value:1024,style:{"background-color":"rgb(238,194,46)",color:"rgb(255,247,235)"}},{level:10,value:2048,style:{"background-color":"rgb(61,58,51)",color:"rgb(255,247,235)"}},{level:11,value:4096,style:{"background-color":"rgb(141 144 251)",color:"rgb(255,247,235)"}},{level:12,value:8192,style:{"background-color":"rgb(166 78 221)",color:"rgb(255,247,235)"}}],animateSpeed:300},r=function(e){var t="";for(var n in e)t+=";"+n+":"+e[n];return t},o=function(e,t,n,r,o){return{left:(e+n)*r+"px",top:(t+n)*o+"px"}},i=function(e,t,n){return e*n+t},l=function(e,t,n,r){return e[i(t,n,r)]},a=function(e,t){this.config=Object.assign({},n,t||{}),this.el=e,this.watcher=[],this.slideTimestamp=0,this.state=Array(this.config.gridHeight*this.config.gridWidth).fill(null),this.__init()};a.prototype.move=function(e){var n,a,s,c,u,d,f,g=this,h=g.state,m=g.config,y=m.gridSizeWidth,p=m.gridSizeHeight,v=m.gridGap,w=m.gridWidth,b=m.gridHeight,x=g.slideTimestamp,T=Date.now();if(T-x<m.animateSpeed)return!1;switch(g.slideTimestamp=T,e){case"up":n=0,s=w-1,a=1,c=b-1,u=0,d=-1;break;case"down":n=0,s=w-1,a=b-2,c=0,u=0,d=1;break;case"right":n=w-2,s=0,a=0,c=b-1,u=1,d=0;break;case"left":n=1,s=w-1,a=0,c=b-1,u=-1,d=0}for(var E=n;E>=Math.min(n,s)&&E<=Math.max(n,s);n>s?E--:E++)for(var M=a;M>=Math.min(a,c)&&M<=Math.max(a,c);a>c?M--:M++){var k=document.querySelector("."+m.cls.gridTpl+E+"_"+M),A=l(h,w,E,M);if(null!=A){var F={x:E+u,y:M+d},S=l(h,w,F.x,F.y),_=0;if(0==n)if(a>c)for(;F.y<b-1&&null==S&&(F.y=F.y+1,S=l(h,w,F.x,F.y),!(++_>Math.max(w,b))););else for(;F.y>0&&null==S&&(F.y=F.y-1,S=l(h,w,F.x,F.y),!(++_>Math.max(w,b))););else if(n>s)for(;F.x<w-1&&null==S&&(F.x=F.x+1,S=l(h,w,F.x,F.y),!(++_>Math.max(w,b))););else for(;F.x>0&&null==S&&(F.x=F.x-1,S=l(h,w,F.x,F.y),!(++_>Math.max(w,b))););var j=o(y,p,v,F.x,F.y);if(null==S)h[i(w,E,M)]=null,h[i(w,F.x,F.y)]=A,k.style.top=j.top,k.style.left=j.left,k.className=m.cls.grid+" "+A.class+" "+m.cls.gridTpl+F.x+"_"+F.y;else if(S.value!=A.value||S.justModified){if(!(S.value!=A.value||_>=1))continue;if(0==n?F.y=a>c?F.y-1:F.y+1:F.x=n>s?F.x-1:F.x+1,F.x==E&&F.y==M)continue;j=o(y,p,v,F.x,F.y),h[i(w,E,M)]=null,h[i(w,F.x,F.y)]=A,k.className=m.cls.grid+" "+A.class+" "+m.cls.gridTpl+F.x+"_"+F.y,k.style.top=j.top,k.style.left=j.left}else{var O=m.grids[A.level+1];O.justModified=!0,h[i(w,E,M)]=null,h[i(w,F.x,F.y)]=O,k.style.top=j.top,k.style.left=j.left,t(k,"transitionend",function(e,t,n,o){return function(){e.style.display="none",e.className="";var i=document.querySelector("."+o.cls.gridTpl+t.x+"_"+t.y),l=n.style;l&&(l=r(l),i.style.cssText=i.style.cssText+l),i.className=o.cls.grid+" "+o.cls.gridTpl+t.x+"_"+t.y+" "+n.class+" ",o.showGridValue&&(i.innerText=n.value)}}(k,F,O,m))}f=!0}}for(var H=0;H<h.length;H++)null!=h[H]&&h[H].justModified&&delete h[H].justModified;g.watcher.forEach((function(e){e&&e.bind(g)({tag:"moved",state:h,self:g})})),f&&setTimeout(g.create.bind(g),m.animateSpeed)},a.prototype.create=function(e,t,n){var l,a,s,c=this,u=c.state,d=c.config,f=d.grids,g=d.gridWidth,h=d.gridHeight,m=d.gridSizeWidth,y=d.gridSizeHeight,p=d.gridGap,v=(l=[],u.forEach((function(e,t){null==e&&l.push(t)})),l);if(!v.length)return!1;if(e>h*g-1||t>g||n>h)return"level or x or y out of the range";a=null!=e?f[e]:Math.random()>=.5?f[0]:f[1];var w=function(e,t){return{x:e%t,y:Math.floor(e/t)}}(s=null!=t&&null!=n?i(g,t,n):v[Math.floor(Math.random()*v.length)],g),b=o(m,y,p,w.x,w.y),x=document.createElement("div"),T=Object.assign({position:"absolute",width:m+"px",height:m+"px",top:b.top,left:b.left},a.style||{});if(T&&(T=r(T),x.style.cssText=T),x.className=d.cls.grid+" "+a.class+" "+d.cls.gridTpl+w.x+"_"+w.y,d.showGridValue&&(x.innerText=a.value),this.el.appendChild(x),u[s]=a,c.watcher.forEach((function(e){e&&e.bind(c)({tag:"create",state:u,self:c})})),1==v.length){for(var E=!1,M=0;M<g&&!E;M++)for(var k=0;k<h&&!E;k++)M>0&&u[i(g,M-1,k)].value==u[i(g,M,k)].value&&(E=!0),M<g-1&&u[i(g,M+1,k)].value==u[i(g,M,k)].value&&(E=!0),k>0&&u[i(g,M,k-1)].value==u[i(g,M,k)].value&&(E=!0),k<g-1&&u[i(g,M,k+1)].value==u[i(g,M,k)].value&&(E=!0);if(!E)return console.log("canmove onFinish",u),d.onFinish&&d.onFinish(u),!1}return!0},a.prototype.start=function(){var e=this.config;this.__init(),this.state=Array(e.gridHeight*e.gridWidth).fill(null),e.onReady&&e.onReady(),this.create()},a.prototype.listen=function(t){if(!e(t))throw"the argument of fn must be a function";this.watcher.push(t)},a.prototype.removeAllListener=function(){this.watcher=[]},a.prototype.__init=function(){this.el.style.cssText="-webkit-user-select:none;user-select:none;",this.el.innerHTML=""};export default a;
